class Comment{constructor(t=null){null!==t&&(this.deleteButton=t,this.deleteComment=this.deleteComment.bind(this),this.deleteButton.addEventListener("click",()=>this.deleteComment(t))),this.addComment=this.addComment.bind(this)}addComment(t){let e=t.target,n=e.value;if(!n)return;let s=e.closest(".tasks-table__tooltip"),o=s.querySelector(".reviews"),i=document.querySelector("#comment");i.content.querySelector(".reviews__content").innerText=n;const a=document.importNode(i.content,!0);if(o)o.appendChild(a);else{console.log("adding first comment");let t=document.createElement("ul");t.className="reviews",t.appendChild(a),s.insertBefore(t,e)}new Comment(s.querySelector("li:last-child .reviews__delete-button")),e.value=""}deleteComment(t){console.log("delete comment");let e=t.parentNode,n=e.parentNode;1!==n.childNodes.length?e.remove():n.remove()}}!function(){class t{constructor(t){this.button=t,this.handleKeyAction=this.handleKeyAction.bind(this),this.showTooltip=this.showTooltip.bind(this),t.addEventListener("click",()=>this.showTooltip(t))}showTooltip(t){let e=document.querySelector("#add-comment-tooltip"),n=t.parentElement;if(null!==n.querySelector(".tasks-table__tooltip"))return;let s=document.importNode(e.content,!0);const o=s.querySelector(".tasks-table__tooltip-input");if(n.appendChild(s),this.tooltip=o.parentNode,t.classList.contains("tasks-table__comment-button--commented")){let t=document.querySelector("#comments-list");const e=document.importNode(t.content,!0);o.parentNode.insertBefore(e,o),document.querySelectorAll(".reviews__delete-button").forEach(t=>{new Comment(t)})}o.focus(),t.classList.add("tasks-table__comment-button--pressed"),document.addEventListener("keydown",this.handleKeyAction)}handleKeyAction(t){"Escape"===t.key?(document.removeEventListener("keydown",this.handleKeyAction),this.tooltip.parentNode.removeChild(this.tooltip),this.button.classList.remove("tasks-table__comment-button--pressed")):"Enter"===t.key&&(console.log("enter presses"),(new Comment).addComment(t))}}document.querySelectorAll(".tasks-table__comment-button").forEach(e=>{new t(e)})}(),function(){new class{constructor(){this.button=document.querySelector(".navigation__toggle-button"),this.list=document.querySelector(".navigation__list"),this.button.addEventListener("click",this.toggle.bind(this))}toggle(){this.list.classList.toggle("navigation__list--open")}}}(),function(){new class{constructor(){this.togglePopup=this.togglePopup.bind(this),this.popup=document.querySelector(".popup"),this.backgroundOverlay=document.querySelector(".popup__background-overlay"),this.closePopupButton=document.querySelector(".popup__close-button"),this.editButton=document.querySelector(".popup__edit-button"),this.closePopupButton.addEventListener("click",this.togglePopup),this.editButton.addEventListener("click",this.togglePopup),document.addEventListener("tableSave",this.togglePopup)}togglePopup(){this.popup.classList.toggle("popup--opened"),this.backgroundOverlay.classList.toggle("popup__background-overlay--visible")}}}(),function(){class t{constructor(t){this.toggleRatingTooltip=this.toggleRatingTooltip.bind(this),this.showRatingTooltip=this.showRatingTooltip.bind(this),this.hideRatingTooltip=this.hideRatingTooltip.bind(this),this.setRange=this.setRange.bind(this),this.setInputValue=this.setInputValue.bind(this),this.changeRangeBackground=this.changeRangeBackground.bind(this),this.setRatingInTd=this.setRatingInTd.bind(this),this.getPercents=this.getPercents.bind(this),this.open=!1,this.showRatingTooltipButton=t,this.showRatingTooltipButton.addEventListener("click",this.toggleRatingTooltip),document.addEventListener("closepopups",()=>{this.open&&this.hideRatingTooltip()})}toggleRatingTooltip(){this.open?this.hideRatingTooltip():this.showRatingTooltip()}hideRatingTooltip(){this.open=!1,this.showRatingTooltipButton.parentNode.querySelector(".tasks-table__rating-tooltip").remove()}getPercents(t,e,n){return 100*(t-e)/(n-e)}setRatingInTd(t){const e=this.ratingTooltip.closest(".tasks-table__column");e.querySelector(".tasks-table__rating").innerText=t;const n=e.querySelector(".tasks-table__progress span");if(5===parseInt(t))n.classList.add("tasks-table__progress--full"),n.style.width="100%";else{n.classList.remove("tasks-table__progress--full");const e=this.getPercents(t,this.min,this.max);n.style.width=`${e}%`}}showRatingTooltip(){document.dispatchEvent(new CustomEvent("closepopups")),this.open=!0;let t=document.querySelector("#rating-tooltip");const e=document.importNode(t.content,!0);this.ratingTooltip=e.querySelector(".tasks-table__rating-tooltip"),this.ratingInput=e.querySelector(".tasks-table__input-rating"),this.rangeInput=e.querySelector(".range"),this.min=this.rangeInput.getAttribute("min"),this.max=this.rangeInput.getAttribute("max");const n=this.showRatingTooltipButton.parentNode,s=n.querySelector(".tasks-table__rating");if(!s){n.querySelector(".tasks-table__no-rated-text").remove();let t=document.querySelector("#rating");const e=document.importNode(t.content,!0);n.appendChild(e)}this.rangeInput.value=null===s?3:s.innerText,this.ratingInput.value=this.rangeInput.value,this.changeRangeBackground(),this.ratingInput.addEventListener("input",this.setRange),this.rangeInput.addEventListener("input",this.setInputValue),this.rangeInput.addEventListener("mouseup",()=>{this.rangeInput.blur()}),n.appendChild(e),document.dispatchEvent(new CustomEvent("ratingChanged",{detail:this.showRatingTooltipButton}))}setRange(t){this.rangeInput.value=t.target.value,this.changeRangeBackground(),this.setRatingInTd(this.rangeInput.value),document.dispatchEvent(new CustomEvent("ratingChanged",{detail:this.rangeInput}))}setInputValue(t){this.ratingInput.value=t.target.value,this.changeRangeBackground(),this.setRatingInTd(this.ratingInput.value),document.dispatchEvent(new CustomEvent("ratingChanged",{detail:this.rangeInput}))}changeRangeBackground(){const t=this.getPercents(this.rangeInput.value,this.min,this.max);this.rangeInput.style.backgroundImage=`linear-gradient(to right, #FFD200 0%, #FFD200 ${t}%, #F0F0F0 ${t}%, #F0F0F0 100%)`}}function e(){document.querySelectorAll(".tasks-table__rate-button").forEach(e=>{new t(e)})}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e()}(),function(){new class{constructor(){this.save=this.save.bind(this),this.saveButton=document.querySelector(".tasks-table__save-button"),this.saveButton.addEventListener("click",this.save)}save(){document.dispatchEvent(new CustomEvent("tableSave")),this.saveButton.blur()}}}(),function(){new class{constructor(){this.checkRatings=this.checkRatings.bind(this),document.addEventListener("ratingChanged",this.checkRatings)}getPercents(t,e,n){return 100*(t-e)/(n-e)}checkRatings(t){const e=t.detail.closest(".tasks-table__row"),n=e.querySelectorAll(".tasks-table__column:not(:last-child) .tasks-table__rating");if(n.length>3){e.classList.add("tasks-table__row--full");let t=e.lastChild.querySelector(".tasks-table__rating");if(null===t){let n=document.querySelector("#rating");const s=document.importNode(n.content,!0);e.lastChild.appendChild(s),t=e.lastChild.querySelector(".tasks-table__rating")}const s=e.lastChild.querySelector(".tasks-table__progress span"),o=Array.from(n).reduce((t,e)=>t+parseInt(e.innerHTML,10),0)/n.length;if(t.innerHTML=o.toFixed(2),5===parseInt(o,10))s.classList.add("tasks-table__progress--full"),s.style.width="100%";else{s.classList.remove("tasks-table__progress--full");const t=this.getPercents(o,1,5);s.style.width=`${t}%`}}}}}();